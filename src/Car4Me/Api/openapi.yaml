openapi: 3.0.3
info:
  title: Car4Me API
  version: 2.0.0
  
servers:
  - url: http://localhost:8080

paths:

  # ==============================
  # CLIENTES
  # ==============================

  /clientes:
    get:
      tags: [Clientes]
      summary: Listar clientes
      responses:
        '200':
          description: Lista de clientes

    post:
      tags: [Clientes]
      summary: Criar cliente
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Cliente"
            example:
              nome: "João Silva"
              email: "joao@example.com"
              telefone: "912345678"
              nif: "123456789"
              morada: "Rua das Flores 12, Porto"
      responses:
        '201':
          description: Cliente criado

  /clientes/{id}:
    get:
      tags: [Clientes]
      summary: Obter cliente por ID
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200': { description: Cliente encontrado }
        '404': { description: Cliente não encontrado }

    put:
      tags: [Clientes]
      summary: Atualizar cliente
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/Cliente" }
            example:
              nome: "João Silva"
              email: "joao@example.com"
              telefone: "912345678"
              nif: "123456789"
              morada: "Rua das Flores 12, Porto"
      responses:
        '200': { description: Cliente atualizado }
        '404': { description: Cliente não encontrado }

    delete:
      tags: [Clientes]
      summary: Eliminar cliente
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200': { description: Cliente eliminado }
        '404': { description: Cliente não encontrado }
  # ==============================
  # VEICULOS
  # ==============================

  /veiculos:
    get:
      tags:
        - Veiculos
      summary: Listar veículos
      parameters:
        - name: estado
          in: query
          schema:
            type: string
            enum:
              - Disponivel
              - Alugado
              - Manutencao

        - name: marca
          in: query
          schema:
            type: string
            enum:
              - Audi
              - BMW
              - Mercedes
              - Volkswagen
              - Renault
              - Peugeot
              - Citroen
              - Toyota
              - Nissan
              - Honda
              - Hyundai
              - Kia
              - Ford
              - Opel
              - Volvo
              - Fiat
              - Seat
              - Skoda
              - Mazda
              - Mitsubishi
              - Jeep
              - Land Rover
              - Mini
              - Porsche
              - Lexus
              - Subaru
              - Alfa Romeo
              - Dacia
              - Jaguar
              - Chevrolet

        - name: id_categoria
          in: query
          schema:
            type: integer

      responses:
        '200':
          description: Lista de veículos

    post:
      tags:
        - Veiculos
      summary: Criar veículo
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Veiculo"
            example:
              marca: "Audi"
              modelo: "A4"
              matricula: "AA-11-BB"
              ano: 2023
              cor: "Preto"
              quilometragem: 15000
              estado: "Disponivel"
              id_categoria: 3
      responses:
        '201':
          description: Veículo criado

  /veiculos/{id}:
    get:
      tags:
        - Veiculos
      summary: Obter veículo por ID
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Veículo encontrado
        '404':
          description: Veículo não encontrado

    put:
      tags:
        - Veiculos
      summary: Atualizar veículo
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Veiculo"
            example:
              marca: "Audi"
              modelo: "A4"
              matricula: "AA-11-BB"
              ano: 2023
              cor: "Preto"
              quilometragem: 15000
              estado: "Disponivel"
              id_categoria: 3
      responses:
        '200':
          description: Veículo atualizado
        '404':
          description: Veículo não encontrado

    delete:
      tags:
        - Veiculos
      summary: Eliminar veículo
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Veículo eliminado
        '404':
          description: Veículo não encontrado
  
  
    
  # ==============================
  # FAVORITOS (CLIENTES VEÍCULOS)
  # ==============================

  # 1) GET — Todas as relações M:N
  /favoritos:
    get:
      tags: [Favoritos]
      summary: Listar todas as relações favoritos 
      responses:
        '200':
          description: Lista completa de favoritos
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id_cliente:
                      type: integer
                    id_veiculo:
                      type: integer

    post:
      tags: [Favoritos]
      summary: Criar uma ou várias relações de favoritos 
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                type: object
                properties:
                  id_cliente:
                    type: integer
                  id_veiculo:
                    type: integer
                required:
                  - id_cliente
                  - id_veiculo
            example:
              - id_cliente: 1
                id_veiculo: 25
              - id_cliente: 1
                id_veiculo: 26
              - id_cliente: 2
                id_veiculo: 30
      responses:
        '201':
          description: Favoritos criados com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  inseridos:
                    type: integer
        '400':
          description: Erro nos dados enviados
        '500':
          description: Erro no servidor

  # 4) Atualizações específicas da relação M-N
  /clientes/{id_cliente}/favoritos/{id_veiculo}:
    put:
      tags: [Favoritos]
      summary: Atualizar favorito (substituir veículo favorito)
      parameters:
        - in: path
          name: id_cliente
          required: true
          schema:
            type: integer
        - in: path
          name: id_veiculo
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                novo_id_veiculo:
                  type: integer
            example:
              novo_id_veiculo: 55
      responses:
        '200':
          description: Favorito atualizado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }
                  atualizado_de: { type: integer }
                  atualizado_para: { type: integer }
        '400':
          description: Dados inválidos ou favorito já existente
        '404':
          description: Cliente ou favorito não encontrado

    delete:
      tags: [Favoritos]
      summary: Remover veículo dos favoritos do cliente
      parameters:
        - in: path
          name: id_cliente
          required: true
          schema:
            type: integer
        - in: path
          name: id_veiculo
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Favorito removido com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Veículo removido dos favoritos
        '404':
          description: Favorito inexistente / cliente ou veículo não encontrado

  # 5) PUT — Trocar o cliente associado ao favorito
  /clientes/{id_cliente}/favoritos/{id_veiculo}/cliente:
    put:
      tags: [Favoritos]
      summary: Alterar o cliente associado ao favorito
      parameters:
        - in: path
          name: id_cliente
          required: true
          schema:
            type: integer
        - in: path
          name: id_veiculo
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                novo_id_cliente:
                  type: integer
            example:
              novo_id_cliente: 20
      responses:
        '200':
          description: Cliente associado ao favorito atualizado
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }
                  atualizado_de: { type: integer }
                  atualizado_para: { type: integer }
        '400':
          description: Dados inválidos ou relação já existente
        '404':
          description: Cliente, novo cliente ou favorito não encontrado

  

  # ==============================
  # RESERVAS
  # ==============================

  /reservas:
    get:
      tags:
        - Reservas
      summary: Listar reservas
      parameters:
        - name: estado
          in: query
          schema:
            type: string
            enum:
              - ativa
              - concluida
              - cancelada

        - name: id_cliente
          in: query
          schema:
            type: integer

        - name: id_veiculo
          in: query
          schema:
            type: integer

      responses:
        '200':
          description: Lista de reservas

    post:
      tags:
        - Reservas
      summary: Criar reserva
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Reserva"
            example:
              id_cliente: 1
              id_veiculo: 3
              id_funcionario: 5
              data_inicio: "2025-01-20T00:00:00.000Z"
              data_fim: "2025-01-25T00:00:00.000Z"
              preco_total: 350
              estado: "ativa"
      responses:
        '201':
          description: Reserva criada

  /reservas/{id}:
    get:
      tags:
        - Reservas
      summary: Obter reserva por ID
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Reserva encontrada
        '404':
          description: Reserva não encontrada

    put:
      tags:
        - Reservas
      summary: Atualizar reserva
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Reserva"
            example:
              id_cliente: 1
              id_veiculo: 3
              id_funcionario: 5
              data_inicio: "2025-01-20T00:00:00.000Z"
              data_fim: "2025-01-25T00:00:00.000Z"
              preco_total: 350
              estado: "ativa"
      responses:
        '200':
          description: Reserva atualizada
        '404':
          description: Reserva não encontrada

    delete:
      tags:
        - Reservas
      summary: Eliminar reserva
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Reserva eliminada
        '404':
          description: Reserva não encontrada


  # ==============================
  # MANUTENCOES
  # ==============================

  /manutencoes:
    get:
      tags: [Manutenções]
      summary: Listar manutenções
      parameters:
        - in: query
          name: id_veiculo
          schema: { type: integer }
      responses:
        '200': { description: Lista de manutenções }

    post:
      tags: [Manutenções]
      summary: Criar manutenção
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/Manutencao" }
            example:
              id_veiculo: 5
              descricao: "Troca de óleo"
              data_manutencao: "2024-12-05T00:00:00.000Z"
              custo: 85
      responses:
        '201': { description: Manutenção criada }

  /manutencoes/{id}:
    get:
      tags: [Manutenções]
      summary: Obter manutenção por ID
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200': { description: Manutenção encontrada }
        '404': { description: Não encontrada }

    put:
      tags: [Manutenções]
      summary: Atualizar manutenção
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/Manutencao" }
            example:
              id_veiculo: 5
              descricao: "Troca de óleo"
              data_manutencao: "2024-12-05T00:00:00.000Z"
              custo: 85
      responses:
        '200': { description: Atualizado }
        '404': { description: Não encontrada }

    delete:
      tags: [Manutenções]
      summary: Eliminar manutenção
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200': { description: Eliminada }
        '404': { description: Não encontrada }

# ====================================================
# COMPONENTS
# ====================================================

components:
  schemas:

    Cliente:
      type: object
      properties:
        nome: { type: string }
        email: { type: string }
        telefone: { type: string }
        nif: { type: string }
        morada: { type: string }

    Funcionario:
      type: object
      properties:
        nome: { type: string }
        email: { type: string }
        cargo: { type: string }
        telefone: { type: string }

    Veiculo:
      type: object
      properties:
        marca:
          type: string
          enum:
            - Audi
            - BMW
            - Mercedes
            - Volkswagen
            - Renault
            - Peugeot
            - Citroen
            - Toyota
            - Nissan
            - Honda
            - Hyundai
            - Kia
            - Ford
            - Opel
            - Volvo
            - Fiat
            - Seat
            - Skoda
            - Mazda
            - Mitsubishi
            - Jeep
            - Land Rover
            - Mini
            - Porsche
            - Lexus
            - Subaru
            - Alfa Romeo
            - Dacia
            - Jaguar
            - Chevrolet
        modelo: { type: string }
        matricula: { type: string }
        ano: { type: integer }
        cor: { type: string }
        quilometragem: { type: integer }
        estado:
          type: string
          enum: [Disponivel, Alugado, Manutencao]
        id_categoria: { type: integer }

    Reserva:
      type: object
      properties:
        id_cliente: { type: integer }
        id_veiculo: { type: integer }
        id_funcionario: { type: integer }
        data_inicio:
          type: string
          format: date-time
        data_fim:
          type: string
          format: date-time
        preco_total: { type: number }
        estado:
          type: string
          enum: [ativa, concluida, cancelada]

    Manutencao:
      type: object
      properties:
        id_veiculo: { type: integer }
        descricao: { type: string }
        data_manutencao:
          type: string
          format: date-time
        custo: { type: number }





